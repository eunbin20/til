# Virtual dom

- 업데이트가 발생하면, 실제 브라우저를 바꾸는 것이 아니라 가상 돔에 한 번 렌더링을 하고 기존의 돔과 비교한 다음 정말로 변화가 필요한 곳에만 최소한의 업데이트를 해주는 것.

- 목적 : 모든 변화에 대한 리렌더링을 빠르게 만들어준다.

- 만약 매 업데이트마다 DOM을 버리고 다시 만든다면?(기존의 방법)

  - 브라우저의 workflow

  1. DOM tree 생성 : 브라우저가 HTML을 전달받으면, 브라우저의 렌더 엔진이 이를 파싱하고 DOM노드로 이루어진 트리를 만든다. 각 노드는 HTML 엘리먼트들과 연관되어있다.

  2. Render tree 생성 : 외부 CSS파일과 각 엘리먼트의 inline스타일을 파싱한다. 스타일 정보를 사용해 DOM트리에 따라 새로운 트리, 렌더 트리를 만든다.
  -> webkit에서는 노드의 스타일을 처리하는 과정을 attatchment라고 부른다.

  3. Layout(reflow) : 렌더트리가 다 만들어지고나면, 레이아웃 과정을 거친다. 각 노드들은 스크린의 좌표가 주어지고, 정확히 어디에 나타나야 할 지 위치가 주어진다.

  4. Painting : 렌더링된 요소들에 색을 입히는 과정. 트리의 각 노드들을 거치면서 paint()메소드를 호출한다.

  돔을 조작할 때마다 위 과정이 반복된다.

- 가상돔에서는 업데이트가 발생하면 다음 과정을 거친다.

  1. 새로운 가상 돔 트리를 만든다.

  2. 이전 버전의 돔츠리와 비교한다.

  3. 최소의 변화만 계산하여 queue에 담는다.
  
  4. 브라우저의 UI를 업데이트한다.
